import{r as t,h as e,H as i,g as s}from"./p-88c206e8.js";function n(t){return"function"==typeof t}function r(t){return e=>{if(function(t){return n(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function o(t){return this instanceof o?(this.v=t,this):new o(t)}function h(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,n=i.apply(t,e||[]),r=[];return s={},h("next"),h("throw"),h("return"),s[Symbol.asyncIterator]=function(){return this},s;function h(t){n[t]&&(s[t]=function(e){return new Promise((function(i,s){r.push([t,e,i,s])>1||c(t,e)}))})}function c(t,e){try{(i=n[t](e)).value instanceof o?Promise.resolve(i.value.v).then(u,l):a(r[0][2],i)}catch(t){a(r[0][3],t)}var i}function u(t){c("next",t)}function l(t){c("throw",t)}function a(t,e){t(e),r.shift(),r.length&&c(r[0][0],r[0][1])}}function c(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},s("next"),s("throw"),s("return"),e[Symbol.asyncIterator]=function(){return this},e);function s(i){e[i]=t[i]&&function(e){return new Promise((function(s,n){!function(t,e,i,s){Promise.resolve(s).then((function(e){t({value:e,done:i})}),e)}(s,n,(e=t[i](e)).done,e.value)}))}}}const u=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function l(t){return n(null==t?void 0:t.then)}function a(t){const e=t((t=>{Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const f=a((t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map(((t,e)=>`${e+1}) ${t.toString()}`)).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e}));function d(t,e){if(t){const i=t.indexOf(e);0<=i&&t.splice(i,1)}}class p{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const t of e)t.remove(this);else e.remove(this);const{initialTeardown:i}=this;if(n(i))try{i()}catch(e){t=e instanceof f?e.errors:[e]}const{_teardowns:s}=this;if(s){this._teardowns=null;for(const e of s)try{v(e)}catch(e){t=null!=t?t:[],e instanceof f?t=[...t,...e.errors]:t.push(e)}}if(t)throw new f(t)}}add(t){var e;if(t&&t!==this)if(this.closed)v(t);else{if(t instanceof p){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(e=this._teardowns)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&d(e,t)}remove(t){const{_teardowns:e}=this;e&&d(e,t),t instanceof p&&t._removeParent(this)}}p.EMPTY=(()=>{const t=new p;return t.closed=!0,t})();const y=p.EMPTY;function g(t){return t instanceof p||t&&"closed"in t&&n(t.remove)&&n(t.add)&&n(t.unsubscribe)}function v(t){n(t)?t():t.unsubscribe()}const w={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},b={setTimeout(...t){const{delegate:e}=b;return((null==e?void 0:e.setTimeout)||setTimeout)(...t)},clearTimeout(t){const{delegate:e}=b;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function m(t){b.setTimeout((()=>{const{onUnhandledError:e}=w;if(!e)throw t;e(t)}))}function S(){}const x=k("C",void 0,void 0);function k(t,e,i){return{kind:t,value:e,error:i}}function j(t){t()}class E extends p{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,g(t)&&t.add(this)):this.destination=R}static create(t,e,i){return new A(t,e,i)}next(t){this.isStopped?_(function(t){return k("N",t,void 0)}(t),this):this._next(t)}error(t){this.isStopped?_(k("E",void 0,t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?_(x,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class A extends E{constructor(t,e,i){let s;if(super(),n(t))s=t;else if(t){let n;({next:s,error:e,complete:i}=t),this&&w.useDeprecatedNextContext?(n=Object.create(t),n.unsubscribe=()=>this.unsubscribe()):n=t,s=null==s?void 0:s.bind(n),e=null==e?void 0:e.bind(n),i=null==i?void 0:i.bind(n)}this.destination={next:s?O(s):S,error:O(null!=e?e:$),complete:i?O(i):S}}}function O(t){return(...e)=>{try{t(...e)}catch(t){m(t)}}}function $(t){throw t}function _(t,e){const{onStoppedNotification:i}=w;i&&b.setTimeout((()=>i(t,e)))}const R={closed:!0,next:S,error:$,complete:S},P="function"==typeof Symbol&&Symbol.observable||"@@observable";function C(t){return t}class N{constructor(t){t&&(this._subscribe=t)}lift(t){const e=new N;return e.source=this,e.operator=t,e}subscribe(t,e,i){const s=(r=t)&&r instanceof E||function(t){return t&&n(t.next)&&n(t.error)&&n(t.complete)}(r)&&g(r)?t:new A(t,e,i);var r;return j((()=>{const{operator:t,source:e}=this;s.add(t?t.call(s,e):e?this._subscribe(s):this._trySubscribe(s))})),s}_trySubscribe(t){try{return this._subscribe(t)}catch(e){t.error(e)}}forEach(t,e){return new(e=I(e))(((e,i)=>{let s;s=this.subscribe((e=>{try{t(e)}catch(t){i(t),null==s||s.unsubscribe()}}),i,e)}))}_subscribe(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)}[P](){return this}pipe(...t){return(0===(e=t).length?C:1===e.length?e[0]:function(t){return e.reduce(((t,e)=>e(t)),t)})(this);var e}toPromise(t){return new(t=I(t))(((t,e)=>{let i;this.subscribe((t=>i=t),(t=>e(t)),(()=>t(i)))}))}}function I(t){var e;return null!==(e=null!=t?t:w.Promise)&&void 0!==e?e:Promise}function U(t){return n(t[P])}function T(t){return Symbol.asyncIterator&&n(null==t?void 0:t[Symbol.asyncIterator])}function B(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}N.create=t=>new N(t);const L="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function M(t){return n(null==t?void 0:t[L])}function F(t){return h(this,arguments,(function*(){const e=t.getReader();try{for(;;){const{value:t,done:i}=yield o(e.read());if(i)return yield o(void 0);yield yield o(t)}}finally{e.releaseLock()}}))}function W(t){return n(null==t?void 0:t.getReader)}function D(t){if(t instanceof N)return t;if(null!=t){if(U(t))return r=t,new N((t=>{const e=r[P]();if(n(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(u(t))return s=t,new N((t=>{for(let e=0;e<s.length&&!t.closed;e++)t.next(s[e]);t.complete()}));if(l(t))return i=t,new N((t=>{i.then((e=>{t.closed||(t.next(e),t.complete())}),(e=>t.error(e))).then(null,m)}));if(T(t))return z(t);if(M(t))return e=t,new N((t=>{for(const i of e)if(t.next(i),t.closed)return;t.complete()}));if(W(t))return z(F(t))}var e,i,s,r;throw B(t)}function z(t){return new N((e=>{(function(t,e){var i,s,n,r,o,h,u,l;return o=this,h=void 0,l=function*(){try{for(i=c(t);!(s=yield i.next()).done;)if(e.next(s.value),e.closed)return}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&(yield r.call(i))}finally{if(n)throw n.error}}e.complete()},new((u=void 0)||(u=Promise))((function(t,e){function i(t){try{n(l.next(t))}catch(t){e(t)}}function s(t){try{n(l.throw(t))}catch(t){e(t)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof u?n:new u((function(t){t(n)}))).then(i,s)}n((l=l.apply(o,h||[])).next())}))})(t,e).catch((t=>e.error(t)))}))}class V extends E{constructor(t,e,i,s,n){super(t),this.onFinalize=n,this._next=e?function(i){try{e(i)}catch(e){t.error(e)}}:super._next,this._error=s?function(e){try{s(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(e){t.error(e)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}class G extends p{constructor(t,e){super()}schedule(t,e=0){return this}}const q={setInterval(...t){const{delegate:e}=q;return((null==e?void 0:e.setInterval)||setInterval)(...t)},clearInterval(t){const{delegate:e}=q;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},H={now:()=>(H.delegate||Date).now(),delegate:void 0};class X{constructor(t,e=X.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}}X.now=H.now;const Y=new class extends X{constructor(t,e=X.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:e}=this;if(this._active)return void e.push(t);let i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}(class extends G{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(s,this.id,e),this}requestAsyncId(t,e,i=0){return q.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return e;q.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i,s=!1;try{this.work(t)}catch(t){s=!0,i=t||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,d(i,this),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}}),J=Y;function K(t){return t&&n(t.schedule)}function Q(t=0,e,i=J){let s=-1;return null!=e&&(K(e)?i=e:s=e),new N((e=>{let n=(r=t)instanceof Date&&!isNaN(r)?+t-i.now():t;var r;n<0&&(n=0);let o=0;return i.schedule((function(){e.closed||(e.next(o++),0<=s?this.schedule(void 0,s):e.complete())}),n)}))}function Z(t,e,i,s=0,n=!1){const r=e.schedule((function(){i(),n?t.add(this.schedule(null,s)):this.unsubscribe()}),s);if(t.add(r),!n)return r}function tt(t,e=0){return r(((i,s)=>{i.subscribe(new V(s,(i=>Z(s,t,(()=>s.next(i)),e)),(()=>Z(s,t,(()=>s.complete()),e)),(i=>Z(s,t,(()=>s.error(i)),e))))}))}function et(t,e=0){return r(((i,s)=>{s.add(t.schedule((()=>i.subscribe(s)),e))}))}function it(t,e){if(!t)throw new Error("Iterable cannot be null");return new N((i=>{Z(i,e,(()=>{const s=t[Symbol.asyncIterator]();Z(i,e,(()=>{s.next().then((t=>{t.done?i.complete():i.next(t.value)}))}),0,!0)}))}))}function st(t,e){return r(((i,s)=>{let n=0;i.subscribe(new V(s,(i=>{s.next(t.call(e,i,n++))})))}))}const{isArray:nt}=Array;function rt(t,e,i=1/0){return n(e)?rt(((i,s)=>st(((t,n)=>e(i,t,s,n)))(D(t(i,s)))),i):("number"==typeof e&&(i=e),r(((e,s)=>function(t,e,i,s){const n=[];let r=0,o=0,h=!1;const c=()=>{!h||n.length||r||e.complete()},u=t=>r<s?l(t):n.push(t),l=t=>{r++;let h=!1;D(i(t,o++)).subscribe(new V(e,(t=>{e.next(t)}),(()=>{h=!0}),void 0,(()=>{if(h)try{for(r--;n.length&&r<s;){const t=n.shift();l(t)}c()}catch(t){e.error(t)}})))};return t.subscribe(new V(e,u,(()=>{h=!0,c()}))),()=>{}}(e,s,t,i))))}const ot=a((t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}));class ht extends N{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const e=new ct(this,this);return e.operator=t,e}_throwIfClosed(){if(this.closed)throw new ot}next(t){j((()=>{if(this._throwIfClosed(),!this.isStopped){const e=this.observers.slice();for(const i of e)i.next(t)}}))}error(t){j((()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:e}=this;for(;e.length;)e.shift().error(t)}}))}complete(){j((()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}}))}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:e,isStopped:i,observers:s}=this;return e||i?y:(s.push(t),new p((()=>d(s,t))))}_checkFinalizedStatuses(t){const{hasError:e,thrownError:i,isStopped:s}=this;e?t.error(i):s&&t.complete()}asObservable(){const t=new N;return t.source=this,t}}ht.create=(t,e)=>new ct(t,e);class ct extends ht{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)}error(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:y}}function ut(...t){return function(t=1/0){return rt(C,t)}(1)((e=t,(i=function(t){return K((e=t)[e.length-1])?t.pop():void 0;var e}(t))?function(t,e){if(null!=t){if(U(t))return function(t,e){return D(t).pipe(et(e),tt(e))}(t,e);if(u(t))return function(t,e){return new N((i=>{let s=0;return e.schedule((function(){s===t.length?i.complete():(i.next(t[s++]),i.closed||this.schedule())}))}))}(t,e);if(l(t))return function(t,e){return D(t).pipe(et(e),tt(e))}(t,e);if(T(t))return it(t,e);if(M(t))return function(t,e){return new N((i=>{let s;return Z(i,e,(()=>{s=t[L](),Z(i,e,(()=>{let t,e;try{({value:t,done:e}=s.next())}catch(t){return void i.error(t)}e?i.complete():i.next(t)}),0,!0)})),()=>n(null==s?void 0:s.return)&&s.return()}))}(t,e);if(W(t))return function(t,e){return it(F(t),e)}(t,e)}throw B(t)}(e,i):D(e)));var e,i}const lt=new N((t=>t.complete()));function at(t){return t<=0?()=>lt:r(((e,i)=>{let s=0;e.subscribe(new V(i,(e=>{++s<=t&&(i.next(e),t<=s&&i.complete())})))}))}function ft(t){return st((()=>t))}function dt(t,e){return e?i=>ut(e.pipe(at(1),r(((t,e)=>{t.subscribe(new V(e,S))}))),i.pipe(dt(t))):rt(((e,i)=>t(e,i).pipe(at(1),ft(e))))}function pt(t,e=C){return t=null!=t?t:yt,r(((i,s)=>{let n,r=!0;i.subscribe(new V(s,(i=>{const o=e(i);!r&&t(n,o)||(r=!1,n=o,s.next(i))})))}))}function yt(t,e){return t===e}function gt(t,e){return r(((i,s)=>{let n=0;i.subscribe(new V(s,(i=>t.call(e,i,n++)&&s.next(i))))}))}class vt extends ht{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){const{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function wt(t,e){return r(((i,s)=>{let n=null,r=0,o=!1;const h=()=>o&&!n&&s.complete();i.subscribe(new V(s,(i=>{null==n||n.unsubscribe();let o=0;const c=r++;D(t(i,c)).subscribe(n=new V(s,(t=>s.next(e?e(i,t,c,o++):t)),(()=>{n=null,h()})))}),(()=>{o=!0,h()})))}))}function bt(t){return r(((e,i)=>{D(t).subscribe(new V(i,(()=>i.complete()),S)),!i.closed&&e.subscribe(i)}))}const mt={leading:!0,trailing:!1};function St(t,e=Y,i=mt){const s=Q(t,e);return function(t,{leading:e,trailing:i}=mt){return r(((s,n)=>{let r=!1,o=null,h=null,c=!1;const u=()=>{null==h||h.unsubscribe(),h=null,i&&(f(),c&&n.complete())},l=()=>{h=null,c&&n.complete()},a=e=>h=D(t(e)).subscribe(new V(n,u,l)),f=()=>{if(r){r=!1;const t=o;o=null,n.next(t),!c&&a(t)}};s.subscribe(new V(n,(t=>{r=!0,o=t,(!h||h.closed)&&(e?f():a(t))}),(()=>{c=!0,(!(i&&r&&h)||h.closed)&&n.complete()})))}))}((()=>s),i)}function xt(t){return`${t.toLowerCase()}-view`}function kt(t,e,i){return i?kt(t,e).pipe((s=i,st((t=>function(t,e){return nt(e)?t(...e):t(e)}(s,t))))):new N((i=>{const s=(...t)=>i.next(1===t.length?t[0]:t),r=t(s);return n(e)?()=>e(s,r):void 0}));var s}var jt;!function(t){t[t.None=0]="None",t[t.PlayingMode=1]="PlayingMode",t[t.WatchingMode=2]="WatchingMode"}(jt||(jt={}));class Et{constructor(){this.availableStatuses={Init:["Signing"],Signing:["Switching"],Switching:["Playing","Watching"],Playing:["Switching"],Watching:["Switching"]}}isAvailableStatus(t,e){return!!this.availableStatuses[e].includes(t)||(console.error(`Switching state from '${e}' to '${t}' is not valid!`),!1)}}class At{constructor(t){this.injector=t,this.state=new vt({userId:"",userName:`test-${Math.floor(1e3*Math.random())}`,mode:jt.None,status:"Init",isLogin:!1,games:{}}),this.statusGuard=this.injector.inject(Et)}setClientMode(t){this.patchState({mode:t})}setUserName(t){this.patchState({userName:t})}setUserId(t){this.patchState({userId:t})}switchStatus(t){const e=this.getState();this.statusGuard.isAvailableStatus(t,e.status)&&this.patchState({status:t})}clearGames(){this.patchState({games:{}})}setGameField(t,e){this.patchGames(t,{gameField:e})}setNextItem(t,e){this.patchGames(t,{nextItem:e})}setLevel(t,e){this.patchGames(t,{level:e})}setScore(t,e){this.patchGames(t,{score:e})}snapshot(){return this.state.value}state$(){return this.state.asObservable().pipe(function(t,e=Y){const i=Q(0,e);return dt((()=>i))}())}mode$(){return this.state$().pipe(st((t=>t.mode)),pt())}status$(){return this.state$().pipe(st((t=>t.status)),pt())}userName$(){return this.state$().pipe(st((t=>t.userName)),pt())}watchingUsers$(){return this.state$().pipe(st((t=>Object.keys(t.games))),pt())}game$(t){return this.state$().pipe(st((e=>{var i;return null!==(i=e.games[t])&&void 0!==i?i:{}})),pt())}games$(){return this.state$().pipe(st((t=>t.games)),pt())}getState(){return this.state.value}patchGames(t,e){var i;const{games:s}=this.getState(),n=null!==(i=s[t])&&void 0!==i?i:{};this.patchState({games:Object.assign(Object.assign({},s),{[t]:Object.assign(Object.assign({},n),e)})})}patchState(t){const e=this.getState();this.state.next(Object.assign(Object.assign({},e),t))}}const Ot={withArgs:!0,withTime:!1,withClassProperties:!1,logFunction:console.info},$t=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,_t=/([^\s,]+)/g,Rt=function(t,e,i,s,n,r){const o=r.withTime?`[${(new Date).toLocaleString().replace(",","")}\t`:"",h=(c=e).constructor?c.constructor.name:null;var c;const u=h?`${h}::`:"",l=r.logFunction||console.info,a=r.withArgs?function(t,e,i){const s=e.toString().replace($t,"");let n=s.slice(s.indexOf("(")+1,s.indexOf(")")).match(_t);return null===n?[]:(i.withArgs instanceof Array?i.withArgs:n).map((function(t){return n.indexOf(t)})).map((function(e){if(-1===e||e>=t.length)return"";try{return"object"==typeof t[e]?`[${n[e]}=${JSON.stringify(t[e])}]`:`[${n[e]}=${t[e]}]`}catch(i){return`[${n[e]}=${t[e]}]`}}))}(n,s,r):null,f=r.withClassProperties?function(t,e){const i=Object.keys(e);var s;return(t instanceof Array?(s=t,i.filter((t=>s.includes(t)))):i).map((function(t){return`[${t}=${e[t]}]`}))}(r.withClassProperties,e):null;r.formatAndLogFunction?r.formatAndLogFunction(o,u,i,t,a,f):(l(`${o}${u}${i}\t${t?"start":"end"}`),a&&0!==a.length&&l(`\t${a.join("\n\t\t")}`),f&&0!==f.length&&l(`\tClass properties:\n\t\t${f.join("\n\t\t")}`))};function Pt(t=Ot){return function(t=Ot){return(e,i,s)=>(void 0===s&&(s=Object.getOwnPropertyDescriptor(e,i)),s.value=function(t,e,i){return function(...s){Rt(!0,this,e,t,s,i);const n=t.apply(this,s);return Rt(!1,this,e,t,s,i),n}}(s.value,i,t),s.value.__loggerMonkeyPatchCompleted=!0,s)}(t)}var Ct=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class Nt{constructor(t){this.injector=t,this.clientStore=this.injector.inject(At)}start(){return this.clientStore.switchStatus("Signing")}stop(){}}Ct([Pt()],Nt.prototype,"start",null),Ct([Pt()],Nt.prototype,"stop",null);var It,Ut=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Tt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Bt=function(t){var e,i,s=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));for(var o,h=Ut.exec(t||""),c={},u=14;u--;)c[Tt[u]]=h[u]||"";return-1!=n&&-1!=r&&(c.source=s,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0),c.pathNames=(i=(e=c.path).replace(/\/{2,9}/g,"/").split("/"),"/"!=e.substr(0,1)&&0!==e.length||i.splice(0,1),"/"==e.substr(e.length-1,1)&&i.splice(i.length-1,1),i),c.queryKey=(o={},c.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){e&&(o[e]=i)})),o),c},Lt=(function(t){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}}(It={path:undefined,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}}),It.exports);const Mt="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Ft(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||Lt))return new XMLHttpRequest}catch(t){}if(!e)try{return new(Mt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function Wt(t,...e){return e.reduce(((e,i)=>(t.hasOwnProperty(i)&&(e[i]=t[i]),e)),{})}const Dt=setTimeout,zt=clearTimeout;function Vt(t,e){e.useNativeTimers?(t.setTimeoutFn=Dt.bind(Mt),t.clearTimeoutFn=zt.bind(Mt)):(t.setTimeoutFn=setTimeout.bind(Mt),t.clearTimeoutFn=clearTimeout.bind(Mt))}var Gt=qt;function qt(t){if(t)return function(t){for(var e in qt.prototype)t[e]=qt.prototype[e];return t}(t)}qt.prototype.on=qt.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},qt.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},qt.prototype.off=qt.prototype.removeListener=qt.prototype.removeAllListeners=qt.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<s.length;n++)if((i=s[n])===e||i.fn===e){s.splice(n,1);break}return 0===s.length&&delete this._callbacks["$"+t],this},qt.prototype.emitReserved=qt.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(i){s=0;for(var n=(i=i.slice(0)).length;s<n;++s)i[s].apply(this,e)}return this},qt.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},qt.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Ht=Object.create(null);Ht.open="0",Ht.close="1",Ht.ping="2",Ht.pong="3",Ht.message="4",Ht.upgrade="5",Ht.noop="6";const Xt=Object.create(null);Object.keys(Ht).forEach((t=>{Xt[Ht[t]]=t}));const Yt={type:"error",data:"parser error"},Jt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Kt="function"==typeof ArrayBuffer,Qt=({type:t,data:e},i,s)=>{return Jt&&e instanceof Blob?i?s(e):Zt(e,s):Kt&&(e instanceof ArrayBuffer||(n=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer))?i?s(e):Zt(new Blob([e]),s):s(Ht[t]+(e||""));var n},Zt=(t,e)=>{const i=new FileReader;return i.onload=function(){const t=i.result.split(",")[1];e("b"+t)},i.readAsDataURL(t)};for(var te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ee="undefined"==typeof Uint8Array?[]:new Uint8Array(256),ie=0;ie<te.length;ie++)ee[te.charCodeAt(ie)]=ie;const se="function"==typeof ArrayBuffer,ne=(t,e)=>{if("string"!=typeof t)return{type:"message",data:oe(t,e)};const i=t.charAt(0);return"b"===i?{type:"message",data:re(t.substring(1),e)}:Xt[i]?t.length>1?{type:Xt[i],data:t.substring(1)}:{type:Xt[i]}:Yt},re=(t,e)=>{if(se){const i=function(t){var e,i,s,n,r,o=.75*t.length,h=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var u=new ArrayBuffer(o),l=new Uint8Array(u);for(e=0;e<h;e+=4)i=ee[t.charCodeAt(e)],s=ee[t.charCodeAt(e+1)],n=ee[t.charCodeAt(e+2)],r=ee[t.charCodeAt(e+3)],l[c++]=i<<2|s>>4,l[c++]=(15&s)<<4|n>>2,l[c++]=(3&n)<<6|63&r;return u}(t);return oe(i,e)}return{base64:!0,data:t}},oe=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},he=String.fromCharCode(30);class ce extends Gt{constructor(t){super(),this.writable=!1,Vt(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e){const i=new Error(t);return i.type="TransportError",i.description=e,super.emit("error",i),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(t){const e=ne(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emit("packet",t)}onClose(){this.readyState="closed",super.emit("close")}}var ue,le="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ae={},fe=0,de=0;function pe(t){var e="";do{e=le[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function ye(){var t=pe(+new Date);return t!==ue?(fe=0,ue=t):t+"."+pe(fe++)}for(;de<64;de++)ae[le[de]]=de;ye.encode=pe,ye.decode=function(t){var e=0;for(de=0;de<t.length;de++)e=64*e+ae[t.charAt(de)];return e};var ge=ye,ve=function(t){var e="";for(var i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e};class we extends ce{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(t){((t,e)=>{const i=t.split(he),s=[];for(let t=0;t<i.length;t++){const n=ne(i[t],e);if(s.push(n),"error"===n.type)break}return s})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose(),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const i=t.length,s=new Array(i);let n=0;t.forEach(((t,r)=>{Qt(t,!1,(t=>{s[r]=t,++n===i&&e(s.join(he))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emit("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let i="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ge()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port);const s=ve(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(s.length?"?"+s:"")}}function be(){}const me=null!=new Ft({xdomain:!1}).responseType;class Se extends Gt{constructor(t,e){super(),Vt(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=Wt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new Ft(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(t){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=Se.requestsCount++,Se.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(t){this.emit("data",t),this.onSuccess()}onError(t){this.emit("error",t),this.cleanup(!0)}cleanup(t){if(null!=this.xhr){if(this.xhr.onreadystatechange=be,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete Se.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&this.onData(t)}abort(){this.cleanup()}}function xe(){for(let t in Se.requests)Se.requests.hasOwnProperty(t)&&Se.requests[t].abort()}Se.requestsCount=0,Se.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",xe):"function"==typeof addEventListener&&addEventListener("onpagehide"in Mt?"pagehide":"unload",xe,!1));const ke="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),je=Mt.WebSocket||Mt.MozWebSocket,Ee="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Ae extends ce{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,i=Ee?{}:Wt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=Ee?new je(t,e,i):e?new je(t,e):new je(t)}catch(t){return this.emit("error",t)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=e===t.length-1;Qt(t[e],this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}i&&ke((()=>{this.writable=!0,this.emit("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let i="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=ge()),this.supportsBinary||(t.b64=1);const s=ve(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(s.length?"?"+s:"")}check(){return!(!je||"__initialize"in je&&this.name===Ae.prototype.name)}}const Oe={websocket:Ae,polling:class extends we{constructor(t){if(super(t),"undefined"!=typeof location){const e="https:"===location.protocol;let i=location.port;i||(i=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==e}this.supportsBinary=me&&!(t&&t.forceBase64)}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Se(this.uri(),t)}doWrite(t,e){const i=this.request({method:"POST",data:t});i.on("success",e),i.on("error",(t=>{this.onError("xhr post error",t)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(t=>{this.onError("xhr poll error",t)})),this.pollXhr=t}}};class $e extends Gt{constructor(t,e={}){super(),t&&"object"==typeof t&&(e=t,t=null),t?(t=Bt(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Bt(e.host).host),Vt(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(t){for(var e={},i=t.split("&"),s=0,n=i.length;s<n;s++){var r=i[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=function(t){const e={};for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}(this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const i=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Oe[t](i)}open(){let t;if(this.opts.rememberUpgrade&&$e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(()=>{this.onClose("transport close")}))}probe(t){let e=this.createTransport(t),i=!1;$e.priorWebsocketSuccess=!1;const s=()=>{i||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!i)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;$e.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{i||"closed"!==this.readyState&&(u(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function n(){i||(i=!0,u(),e.close(),e=null)}const r=t=>{const i=new Error("probe error: "+t);i.transport=e.name,n(),this.emitReserved("upgradeError",i)};function o(){r("transport closed")}function h(){r("socket closed")}function c(t){e&&t.name!==e.name&&n()}const u=()=>{e.removeListener("open",s),e.removeListener("error",r),e.removeListener("close",o),this.off("close",h),this.off("upgrading",c)};e.once("open",s),e.once("error",r),e.once("close",o),this.once("close",h),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",$e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(t,e,i){return this.sendPacket("message",t,e,i),this}send(t,e,i){return this.sendPacket("message",t,e,i),this}sendPacket(t,e,i,s){if("function"==typeof e&&(s=e,e=void 0),"function"==typeof i&&(s=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const n={type:t,data:e,options:i};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),s&&this.once("flush",s),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},i=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?i():t()})):this.upgrading?i():t()),this}onError(t){$e.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let i=0;const s=t.length;for(;i<s;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}}$e.protocol=4;const _e="function"==typeof ArrayBuffer,Re=Object.prototype.toString,Pe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Re.call(Blob),Ce="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Re.call(File);function Ne(t){return _e&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||Pe&&t instanceof Blob||Ce&&t instanceof File}function Ie(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,i=t.length;e<i;e++)if(Ie(t[e]))return!0;return!1}if(Ne(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Ie(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&Ie(t[e]))return!0;return!1}function Ue(t){const e=[],i=t;return i.data=Te(t.data,e),i.attachments=e.length,{packet:i,buffers:e}}function Te(t,e){if(!t)return t;if(Ne(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}if(Array.isArray(t)){const i=new Array(t.length);for(let s=0;s<t.length;s++)i[s]=Te(t[s],e);return i}if("object"==typeof t&&!(t instanceof Date)){const i={};for(const s in t)t.hasOwnProperty(s)&&(i[s]=Te(t[s],e));return i}return t}function Be(t,e){return t.data=Le(t.data,e),t.attachments=void 0,t}function Le(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=Le(t[i],e);else if("object"==typeof t)for(const i in t)t.hasOwnProperty(i)&&(t[i]=Le(t[i],e));return t}var Me;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Me||(Me={}));class Fe extends Gt{constructor(){super()}add(t){let e;if("string"==typeof t)e=this.decodeString(t),e.type===Me.BINARY_EVENT||e.type===Me.BINARY_ACK?(this.reconstructor=new We(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e);else{if(!Ne(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const i={type:Number(t.charAt(0))};if(void 0===Me[i.type])throw new Error("unknown packet type "+i.type);if(i.type===Me.BINARY_EVENT||i.type===Me.BINARY_ACK){const s=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const n=t.substring(s,e);if(n!=Number(n)||"-"!==t.charAt(e))throw new Error("Illegal attachments");i.attachments=Number(n)}if("/"===t.charAt(e+1)){const s=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);i.nsp=t.substring(s,e)}else i.nsp="/";const s=t.charAt(e+1);if(""!==s&&Number(s)==s){const s=e+1;for(;++e;){const i=t.charAt(e);if(null==i||Number(i)!=i){--e;break}if(e===t.length)break}i.id=Number(t.substring(s,e+1))}if(t.charAt(++e)){const s=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(e));if(!Fe.isPayloadValid(i.type,s))throw new Error("invalid payload");i.data=s}return i}static isPayloadValid(t,e){switch(t){case Me.CONNECT:return"object"==typeof e;case Me.DISCONNECT:return void 0===e;case Me.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case Me.EVENT:case Me.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case Me.ACK:case Me.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class We{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=Be(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const De=Object.freeze({__proto__:null,protocol:5,get PacketType(){return Me},Encoder:class{encode(t){return t.type!==Me.EVENT&&t.type!==Me.ACK||!Ie(t)?[this.encodeAsString(t)]:(t.type=t.type===Me.EVENT?Me.BINARY_EVENT:Me.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==Me.BINARY_EVENT&&t.type!==Me.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data)),e}encodeAsBinary(t){const e=Ue(t),i=this.encodeAsString(e.packet),s=e.buffers;return s.unshift(i),s}},Decoder:Fe});function ze(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const Ve=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ge extends Gt{constructor(t,e,i){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,i&&i.auth&&(this.auth=i.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ze(t,"open",this.onopen.bind(this)),ze(t,"packet",this.onpacket.bind(this)),ze(t,"error",this.onerror.bind(this)),ze(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(Ve.hasOwnProperty(t))throw new Error('"'+t+'" is a reserved event name');e.unshift(t);const i={type:Me.EVENT,data:e,options:{}};return i.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(this.acks[this.ids]=e.pop(),i.id=this.ids++),this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?this.packet(i):this.sendBuffer.push(i)),this.flags={},this}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this.packet({type:Me.CONNECT,data:t})})):this.packet({type:Me.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",t)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Me.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Me.EVENT:case Me.BINARY_EVENT:this.onevent(t);break;case Me.ACK:case Me.BINARY_ACK:this.onack(t);break;case Me.DISCONNECT:this.ondisconnect();break;case Me.CONNECT_ERROR:const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const i of e)i.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let i=!1;return function(...s){i||(i=!0,e.packet({type:Me.ACK,id:t,data:s}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>this.packet(t))),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Me.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var qe=He;function He(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}He.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-i:t+i}return 0|Math.min(t,this.max)},He.prototype.reset=function(){this.attempts=0},He.prototype.setMin=function(t){this.ms=t},He.prototype.setMax=function(t){this.max=t},He.prototype.setJitter=function(t){this.jitter=t};class Xe extends Gt{constructor(t,e){var i;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,Vt(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=e.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new qe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const s=e.parser||De;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new $e(this.uri,this.opts);const e=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const s=ze(e,"open",(function(){i.onopen(),t&&t()})),n=ze(e,"error",(e=>{i.cleanup(),i._readyState="closed",this.emitReserved("error",e),t?t(e):i.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&s();const i=this.setTimeoutFn((()=>{s(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&i.unref(),this.subs.push((function(){clearTimeout(i)}))}return this.subs.push(s),this.subs.push(n),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ze(t,"ping",this.onping.bind(this)),ze(t,"data",this.ondata.bind(this)),ze(t,"error",this.onerror.bind(this)),ze(t,"close",this.onclose.bind(this)),ze(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,e){let i=this.nsps[t];return i||(i=new Ge(this,t,e),this.nsps[t]=i),i}_destroy(t){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let i=0;i<e.length;i++)this.engine.write(e[i],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&i.unref(),this.subs.push((function(){clearTimeout(i)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Ye={};function Je(t,e){"object"==typeof t&&(e=t,t=void 0);const i=function(t,e="",i){let s=t;i=i||"undefined"!=typeof location&&location,null==t&&(t=i.protocol+"//"+i.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?i.protocol+t:i.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==i?i.protocol+"//"+t:"https://"+t),s=Bt(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const n=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+n+":"+s.port+e,s.href=s.protocol+"://"+n+(i&&i.port===s.port?"":":"+s.port),s}(t,(e=e||{}).path||"/socket.io"),s=i.source,n=i.id;let r;return e.forceNew||e["force new connection"]||!1===e.multiplex||Ye[n]&&i.path in Ye[n].nsps?r=new Xe(s,e):(Ye[n]||(Ye[n]=new Xe(s,e)),r=Ye[n]),i.query&&!e.query&&(e.query=i.queryKey),r.socket(i.path,e)}Object.assign(Je,{Manager:Xe,Socket:Ge,io:Je,connect:Je});var Ke=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class Qe{constructor(){this.socket=Je("http://127.0.0.1:3000/",{upgrade:!0,transports:["websocket"]}),this._isConnected=new vt(!1),this._isConnected.next(this.socket.connected),this.onConnected$.subscribe((t=>{this._isConnected.next(!0),console.log("[WIP] GameApiService:onConnect",t)})),this.onConnectFailed$.subscribe((t=>{this._isConnected.next(!1),console.log("[WIP] GameApiService:onConnectFailed",t)})),this.onDisconnected$.subscribe((t=>{this._isConnected.next(!1),console.log("[WIP] GameApiService:onDisconnect",t)})),this.onReconnectSuccess$.subscribe((t=>console.log("[WIP] GameApiService:onReconnectSuccess",t))),this.onReconnectFail$.subscribe((t=>console.log("[WIP] GameApiService:onReconnectFail",t))),this.onReconnectFailed$.subscribe((t=>console.log("[WIP] GameApiService:onReconnectFailed",t))),this.socket.connected||this.socket.connect()}whenConnected$(){return this._isConnected.asObservable().pipe(gt(Boolean),at(1))}registerUser(t){this.socket.emit("registerUser",t)}startWatching(){this.socket.emit("StartWatchingMode")}stopWatching(){this.socket.emit("StopWatchingMode")}startPlaying(){this.socket.emit("StartPlayingMode"),this.socket.emit("StartNewGame")}stopPlaying(){this.socket.emit("StopPlayingMode")}moveFigure(t){this.socket.emit("MoveFigure",t)}rotateFigure(t){this.socket.emit("RotateFigure",t)}dropFigure(){this.socket.emit("DropFigure")}get onSignOn$(){return this.actionToStream$("userLoginSuccess")}get onGameFieldUpdated$(){return this.actionToStream$("UpdateGameView")}get onNextItemUpdated$(){return this.actionToStream$("UpdateNextFigure")}get onScoreUpdated$(){return this.actionToStream$("UpdateScore")}get onLevelUpdated$(){return this.actionToStream$("UpdateLevel")}get onUserAdded$(){return this.actionToStream$("AddUser")}get onUserRemoved$(){return this.actionToStream$("RemoveUser")}get onDisconnected$(){return this.actionToStream$("disconnect")}get onConnected$(){return this.actionToStream$("connect")}get onConnectFailed$(){return this.actionToStream$("connect_error")}get onReconnectSuccess$(){return this.actionToStream$("reconnect")}get onReconnectFail$(){return this.actionToStream$("reconnect_error")}get onReconnectFailed$(){return this.actionToStream$("reconnect_failed")}actionToStream$(t){return kt(this.socket.on.bind(this.socket,t),this.socket.off.bind(this.socket,t))}}Ke([Pt()],Qe.prototype,"registerUser",null),Ke([Pt()],Qe.prototype,"startWatching",null),Ke([Pt()],Qe.prototype,"stopWatching",null),Ke([Pt()],Qe.prototype,"startPlaying",null),Ke([Pt()],Qe.prototype,"stopPlaying",null),Ke([Pt()],Qe.prototype,"moveFigure",null),Ke([Pt()],Qe.prototype,"rotateFigure",null),Ke([Pt()],Qe.prototype,"dropFigure",null);class Ze{constructor(t){this.injector=t,this.gameApiService=this.injector.inject(Qe),this.userStore=this.injector.inject(At),this.onStop$=new ht}start(){this.gameApiService.onGameFieldUpdated$.pipe(bt(this.onStop$)).subscribe((t=>{this.userStore.setGameField(t.username,t.state)})),this.gameApiService.onNextItemUpdated$.pipe(bt(this.onStop$)).subscribe((t=>{this.userStore.setNextItem(t.username,t.item)})),this.gameApiService.onLevelUpdated$.pipe(bt(this.onStop$)).subscribe((t=>{this.userStore.setLevel(t.username,t.value)})),this.gameApiService.onScoreUpdated$.pipe(bt(this.onStop$)).subscribe((t=>{this.userStore.setScore(t.username,t.value)}))}stop(){this.userStore.clearGames(),this.onStop$.next()}}var ti=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class ei{constructor(t){this.injector=t,this.gameApiService=this.injector.inject(Qe),this.gameControllerService=this.injector.inject(Ze),this.onStop$=new ht}start(){this.gameControllerService.start(),this.gameApiService.whenConnected$().pipe(bt(this.onStop$.asObservable())).subscribe((()=>this.gameApiService.startPlaying()))}stop(){this.gameControllerService.stop(),this.gameApiService.whenConnected$().pipe(at(1)).subscribe((()=>this.gameApiService.stopPlaying())),this.onStop$.next()}}ti([Pt()],ei.prototype,"start",null),ti([Pt()],ei.prototype,"stop",null);class ii{constructor(){this.notificationsState=function(){let t=[];const e={listenerIds:[],listeners:{}};return{setState:i=>{t=i,setTimeout((()=>{e.listenerIds.forEach((i=>e.listeners[i](t)))}))},getState:()=>t,addListener:i=>{const s=Symbol();return e.listeners[s]=i,e.listenerIds=[...e.listenerIds,s],setTimeout((()=>i(t))),s},removeListener:t=>{e.listenerIds=e.listenerIds.filter((e=>e!==t)),e.listeners[t]=void 0}}}()}pushNotification(t){const e=this.notificationsState.getState();this.notificationsState.setState([...e,t])}addNotificationsListener(t){return this.notificationsState.addListener(t)}removeNotificationListener(t){this.notificationsState.removeListener(t)}}var si=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class ni{constructor(t){this.injector=t,this.gameApiService=this.injector.inject(Qe),this.userNotificationsService=this.injector.inject(ii),this.clientStore=this.injector.inject(At)}start(){this.signInSub=this.clientStore.userName$().pipe(gt(Boolean),wt((t=>this.gameApiService.whenConnected$().pipe(ft(t))))).subscribe((t=>this.gameApiService.registerUser({userName:t}))),this.signOnSub=this.gameApiService.whenConnected$().pipe(wt((()=>this.gameApiService.onSignOn$))).subscribe((t=>this.onSignOn(t)))}stop(){var t,e;null===(t=this.signInSub)||void 0===t||t.unsubscribe(),this.signInSub=void 0,null===(e=this.signOnSub)||void 0===e||e.unsubscribe(),this.signOnSub=void 0}onSignOn(t){this.userNotificationsService.pushNotification({message:`There ${t.numUsers} user${1===t.numUsers?"":"s"} now`}),this.clientStore.setUserId(t.id),this.clientStore.setClientMode(jt.PlayingMode),this.clientStore.switchStatus("Switching")}}si([Pt()],ni.prototype,"start",null),si([Pt()],ni.prototype,"stop",null),si([Pt()],ni.prototype,"onSignOn",null);var ri=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class oi{constructor(t){this.injector=t,this.clientStore=this.injector.inject(At)}start(){this.subscription=this.clientStore.mode$().subscribe((t=>{switch(console.log("switch",t),t){case jt.WatchingMode:return this.clientStore.switchStatus("Watching");case jt.PlayingMode:return this.clientStore.switchStatus("Playing")}}))}stop(){var t;null===(t=this.subscription)||void 0===t||t.unsubscribe(),this.subscription=void 0}}ri([Pt()],oi.prototype,"start",null),ri([Pt()],oi.prototype,"stop",null);var hi=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};class ci{constructor(t){this.injector=t,this.gameApiService=this.injector.inject(Qe),this.gameControllerService=this.injector.inject(Ze),this.onStop$=new ht}start(){this.gameControllerService.start(),this.gameApiService.whenConnected$().pipe(bt(this.onStop$.asObservable())).subscribe((()=>this.gameApiService.startWatching()))}stop(){this.gameControllerService.stop(),this.gameApiService.whenConnected$().pipe(at(1)).subscribe((()=>this.gameApiService.stopWatching())),this.onStop$.next()}}hi([Pt()],ci.prototype,"start",null),hi([Pt()],ci.prototype,"stop",null);class ui{constructor(t){this.injector=t,this.controllerByTypes={Init:Nt,Signing:ni,Switching:oi,Playing:ei,Watching:ci},this.clientStore=this.injector.inject(At)}init(){this.clientStore.status$().subscribe((t=>this.statusChanged(t)))}statusChanged(t){var e;null===(e=this._activeController)||void 0===e||e.stop(),this._activeController=this.injector.inject(this.controllerByTypes[t]),this._activeController.start()}}class li{static get(){return li.unit||(li.unit=new ai),li.unit}}class ai{constructor(){this.injectionMap=new Map}inject(t){if(!this.injectionMap.has(t)){const e=this.initialize(t);this.injectionMap.set(t,e)}return this.injectionMap.get(t)}initialize(t){var e;try{return new t(this)}catch(i){throw new Error(`${this.constructor.name}: ${i.message} (${typeof t} ${null===(e=null==t?void 0:t.constructor)||void 0===e?void 0:e.name})`)}}}var fi=function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};let di=class{constructor(e){t(this,e),this.clientStore=li.get().inject(At),this.clientStatusMediator=li.get().inject(ui),this.clientStatusMediator.init(),this.clientStore.status$().pipe(St(1)).subscribe((t=>{console.log("AppRoot",t),this.clientState=t}))}connectedCallback(){}disconnectedCallback(){}render(){return e("div",{class:"app-wrapper"},e("header",null,"Stencil App Starter (",this.clientState,")",e("mode-switcher",null)),e("main",{class:"page-wrapper"},this.renderClientView()))}renderClientView(){switch(this.clientState){case"Init":case"Switching":return this.renderSuspendView();case"Signing":return this.renderLoginView();case"Watching":return this.renderWatchingView();case"Playing":return this.renderPlayingView();default:return this.renderErrorView()}}renderSuspendView(){return e("suspend-view",{id:xt(this.clientState)})}renderLoginView(){return e("login-view",{id:xt(this.clientState)})}renderErrorView(){return e("div",null,e("h2",{style:{color:"#884444",fontWeight:"bolded"}},"ERROR"),e("p",null,"Welcome to the Stencil App Starter. You can use this starter to build entire apps all with web components using Stencil! Check out our docs on"," ",e("a",{href:"https://stenciljs.com"},"stenciljs.com")," to get started."))}renderWatchingView(){return e("watching-view",{id:xt(this.clientState)})}renderPlayingView(){return e("playing-view",{id:xt(this.clientState)})}};fi([Pt()],di.prototype,"connectedCallback",null),fi([Pt()],di.prototype,"disconnectedCallback",null),fi([Pt()],di.prototype,"render",null),fi([Pt()],di.prototype,"renderClientView",null),fi([Pt()],di.prototype,"renderSuspendView",null),fi([Pt()],di.prototype,"renderLoginView",null),fi([Pt()],di.prototype,"renderErrorView",null),fi([Pt()],di.prototype,"renderWatchingView",null),di.style=":host{height:100%;width:100%}header{background:#5851ff;font-size:1.4rem;color:white;line-height:3rem;display:block;align-items:center;box-shadow:0 2px 5px 0 rgba(0, 0, 0, 0.26)}.app-wrapper{display:flex;flex-direction:column;height:100%;width:100%}.page-wrapper{flex-grow:1}";let pi=class{constructor(e){t(this,e),this.size=1,this.useBgCells=!0}render(){return this.state?e(i,null,this.state.map((t=>e("div",{class:{row:!0,small:0===this.size}},t.map((t=>e("div",{class:{cell:!0,small:0===this.size,hide:!this.useBgCells&&" "===t,empty:" "===t}}))))))):e(i,null)}};pi.style=":host{display:block}.row{display:flex}.cell{width:35px;height:35px;line-height:35px;border:4px solid #555555;box-sizing:border-box}.cell.small{width:15px;height:15px;line-height:15px;border:3px solid #555555}.cell.empty{border:1px solid #909090}.cell.empty.hide{border:0px}";let yi=class{constructor(e){t(this,e),this.size=1}render(){var t;return e("span",{class:0===this.size?"level small":"level"},"LVL: ",null!==(t=this.level)&&void 0!==t?t:"?")}};yi.style=":host{display:block}.level{font-size:3em}.level.small{font-size:1em}";let gi=class{constructor(e){t(this,e),this.size=1}render(){var t;return e("span",{class:0===this.size?"score small":"score"},"SCR: ",null!==(t=this.score)&&void 0!==t?t:"?")}};gi.style=":host{display:block}.score{font-size:5em}.score.small{font-size:2em}";let vi=class{constructor(e){t(this,e),this.size=1}render(){return e(i,null,e("div",{class:"header"},e("game-score",{score:this.score,size:this.size}),e("game-level",{level:this.level,size:this.size})),e("div",{class:"content"},e("game-field",{state:this.state,size:this.size}),e("game-field",{class:"next-item",state:this.nextItem,size:this.size,useBgCells:!1})))}};vi.style=":host{display:block;border:1px solid #909090;padding:5px}.header{display:grid;grid-gap:25px;grid-template-columns:1fr 1fr}.content{display:grid;grid-gap:25px;grid-template-columns:10fr 4fr}";let wi=class{constructor(e){t(this,e),this.inputId=`input_${Date.now().toString(36)}-${Math.floor(16777215*Math.random()).toString(36)}`,this.userStore=li.get().inject(At)}componentDidRender(){this.checkInputValue()}onWindowKeyPressed(t){t.composedPath()[0]!==this.inputEl&&this.inputEl.focus(),console.log(t.code,t.key),"Enter"===t.code&&this.updateUserName()}updateUserName(){this.userStore.setUserName(this.inputEl.value)}setInputElement(){this.inputEl=this.host.shadowRoot.getElementById(this.inputId),this.inputEl||console.error("Cannot find input element in host",this.host)}render(){return e(i,null,e("div",{class:"form"},e("h3",{class:"title"},"What's your nickname?"),e("input",{class:"input",id:this.inputId,type:"text",maxlength:"14"})))}checkInputValue(){this.setInputElement();const t=this.userStore.snapshot().userName;this.inputEl.value=null!=t?t:""}get host(){return s(this)}};wi.style=":host{display:block;width:100%;height:100%;background-color:#666666}.form{height:100px;margin-top:-100px;position:absolute;text-align:center;top:50%;width:100%}.input{background-color:transparent;border:none;border-bottom:2px solid #fff;outline:none;padding-bottom:15px;text-align:center;width:400px;font-size:2rem;letter-spacing:0.3rem;color:#fff;font-weight:100}.title{font-size:2rem;color:#fff;font-weight:100}";let bi=class{constructor(e){t(this,e),this.clientStore=li.get().inject(At),this.clientStore.mode$().pipe(St(1)).subscribe((t=>this.mode=t))}render(){return e(i,null,this.mode===jt.PlayingMode?this.renderWatchSwitcher():this.renderPlaySwitcher())}renderWatchSwitcher(){return e("button",{onClick:this.switchToWatchMode.bind(this)},"Watch")}renderPlaySwitcher(){return e("button",{onClick:this.switchToPlayMode.bind(this)},"Play")}switchToWatchMode(){this.clientStore.setClientMode(jt.WatchingMode),this.clientStore.switchStatus("Switching")}switchToPlayMode(){this.clientStore.setClientMode(jt.PlayingMode),this.clientStore.switchStatus("Switching")}};var mi;bi.style=":host{display:inline-block;margin-left:20px}",function(t){t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown"}(mi||(mi={}));let Si=class{constructor(e){t(this,e),this.game={},this.clientStore=li.get().inject(At),this.gameApiService=li.get().inject(Qe),this.clientStore.userName$().pipe(wt((t=>this.clientStore.game$(t)))).subscribe((t=>this.game=t)),this.gameActions=this.getActions(this.gameApiService)}onKeyDown(t){Object.values(mi).includes(t.key)&&(t.preventDefault(),t.stopImmediatePropagation(),this.gameActions[t.key]())}render(){return e(i,null,this.game?this.renderGame(this.game):"NONE")}getActions(t){return{ArrowLeft:t.moveFigure.bind(t,"left"),ArrowRight:t.moveFigure.bind(t,"right"),ArrowUp:t.rotateFigure.bind(t,"right"),ArrowDown:t.dropFigure.bind(t)}}renderGame(t){return e("game-wrapper",{score:t.score,level:t.level,nextItem:t.nextItem,state:t.gameField})}};Si.style=":host{display:block}";let xi=class{constructor(e){t(this,e)}render(){return e(i,null,"Suspend")}};xi.style=":host{display:block}";let ki=class{constructor(e){t(this,e),this.usernames=[],this.games={},this.clientStore=li.get().inject(At),this.clientStore.watchingUsers$().subscribe((t=>this.usernames=t)),this.clientStore.games$().subscribe((t=>this.games=t))}render(){return e(i,null,e("div",{class:"games"},this.usernames.map((t=>this.games[t])).filter(Boolean).map(this.renderGame.bind(this))))}renderGame(t){return e("game-wrapper",{score:t.score,level:t.level,nextItem:t.nextItem,state:t.gameField,size:0})}};ki.style=":host{display:block;overflow:auto}.games{padding:25px;display:grid;grid-gap:25px;grid-template-columns:1fr 1fr 1fr 1fr 1fr}";export{di as app_root,pi as game_field,yi as game_level,gi as game_score,vi as game_wrapper,wi as login_view,bi as mode_switcher,Si as playing_view,xi as suspend_view,ki as watching_view}